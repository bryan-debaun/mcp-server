// Prisma schema for MCP Server
// Simplified for single-user personal website with Supabase Auth

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum ItemStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

// Note: Prisma 7 requires the datasource URL to be configured in `prisma.config.ts`.
// See `prisma.config.ts` for local dev config and CI usage.

// Minimal profile linked to Supabase Auth user
model Profile {
  id        String   @id // UUID from Supabase Auth user.id
  email     String   @unique
  name      String?
  isAdmin   Boolean  @default(false) @map("is_admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isAdmin])
}

model Author {
  id        Int          @id @default(autoincrement())
  name      String
  bio       String?
  website   String?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  books     BookAuthor[]

  @@index([name])
}

model Book {
  id          Int          @id @default(autoincrement())
  title       String
  status      ItemStatus   @default(NOT_STARTED)
  description String?
  isbn        String?      @unique
  publishedAt DateTime?
  rating      Int? // 1-10 scale rating
  review      String? // Optional review text
  ratedAt     DateTime? // When rated
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  authors     BookAuthor[]

  @@index([title])
  @@index([isbn])
  @@index([status])
  @@index([rating])
}

model BookAuthor {
  bookId   Int
  authorId Int
  book     Book   @relation(fields: [bookId], references: [id], onDelete: Cascade)
  author   Author @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@id([bookId, authorId])
  @@index([authorId])
}

enum Platform {
  PlayStation
  Xbox
  PC
}

model Movie {
  id          Int        @id @default(autoincrement())
  title       String
  status      ItemStatus @default(NOT_STARTED)
  description String?
  iasn        String?    @unique
  imdbId      String?    @unique @map("imdb_id")
  releasedAt  DateTime?
  rating      Int? // 1-10 scale rating
  review      String? // Optional review text
  ratedAt     DateTime? // When rated
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@index([title])
  @@index([iasn])
  @@index([rating])
}

model VideoGame {
  id          Int        @id @default(autoincrement())
  title       String
  status      ItemStatus @default(NOT_STARTED)
  description String?
  platform    Platform
  igdbId      String?    @unique @map("igdb_id")
  releasedAt  DateTime?
  rating      Int? // 1-10 scale rating
  review      String? // Optional review text
  ratedAt     DateTime? // When rated
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@index([title])
  @@index([platform])
  @@index([rating])
}

model ContentCreator {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  website     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([name])
}

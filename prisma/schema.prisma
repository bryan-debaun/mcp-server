// Prisma schema for MCP Server
// Simplified for single-user personal website with Supabase Auth

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum ItemStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

// Note: Prisma 7 requires the datasource URL to be configured in `prisma.config.ts`.
// See `prisma.config.ts` for local dev config and CI usage.

// Minimal profile linked to Supabase Auth user
model Profile {
  id        String   @id // UUID from Supabase Auth user.id
  email     String   @unique
  name      String?
  isAdmin   Boolean  @default(false) @map("is_admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isAdmin])
}

model Author {
  id        Int          @id @default(autoincrement())
  name      String
  bio       String?
  website   String?
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  books     BookAuthor[]

  @@index([name])
}

model Book {
  id          Int          @id @default(autoincrement())
  title       String
  status      ItemStatus   @default(NOT_STARTED)
  description String?
  isbn        String?      @unique
  publishedAt DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  authors     BookAuthor[]
  rating      Rating?

  @@index([title])
  @@index([isbn])
  @@index([status])
}

model BookAuthor {
  bookId   Int
  authorId Int
  book     Book   @relation(fields: [bookId], references: [id], onDelete: Cascade)
  author   Author @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@id([bookId, authorId])
  @@index([authorId])
}

enum Platform {
  PlayStation
  Xbox
  PC
}

model Movie {
  id          Int        @id @default(autoincrement())
  title       String
  status      ItemStatus @default(NOT_STARTED)
  description String?
  iasn        String?    @unique
  imdbId      String?    @unique @map("imdb_id")
  releasedAt  DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  rating      Rating?

  @@index([title])
  @@index([iasn])
}

model VideoGame {
  id          Int        @id @default(autoincrement())
  title       String
  status      ItemStatus @default(NOT_STARTED)
  description String?
  platform    Platform
  igdbId      String?    @unique @map("igdb_id")
  releasedAt  DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  rating      Rating?

  @@index([title])
  @@index([platform])
}

model ContentCreator {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  website     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([name])
}

// Single rating per entity (only you rate content)
model Rating {
  id          Int        @id @default(autoincrement())
  entityType  String     @map("entity_type")
  entityId    Int        @map("entity_id")
  bookId      Int?       @unique @map("bookId")
  book        Book?      @relation(fields: [bookId], references: [id])
  movieId     Int?       @unique
  movie       Movie?     @relation(fields: [movieId], references: [id])
  videoGameId Int?       @unique @map("video_game_id")
  videoGame   VideoGame? @relation(fields: [videoGameId], references: [id])
  rating      Int
  review      String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@unique([entityType, entityId])
  @@index([entityType, entityId])
}
